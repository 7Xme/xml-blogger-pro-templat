<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Chat App Simulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-color);
            min-height: 100vh;
        }

        /* Mobile Phone Frame */
        .phone-container {
            max-width: 375px;
            margin: 20px auto;
            background: #000;
            border-radius: 30px;
            padding: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        }

        .phone-notch {
            width: 150px;
            height: 25px;
            background: #000;
            border-radius: 0 0 15px 15px;
            margin: 0 auto 10px;
            position: relative;
        }

        .notch-speaker {
            width: 40px;
            height: 5px;
            background: #333;
            border-radius: 3px;
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .phone-screen {
            background: var(--card-bg);
            border-radius: 15px;
            height: 667px;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 10;
        }

        .back-btn {
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            font-size: 16px;
        }

        .contact-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            font-size: 16px;
        }

        /* Chat Container */
        .chat-container {
            height: calc(100% - 140px);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #ffffff;
        }

        .message {
            margin-bottom: 15px;
            animation: messageSlideIn 0.3s ease-out;
        }

        .message.sent {
            display: flex;
            justify-content: flex-end;
        }

        .message.received {
            display: flex;
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.sent .message-bubble {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.received .message-bubble {
            background: #f1f5f9;
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
            text-align: center;
        }

        .message.sent .message-time {
            text-align: right;
        }

        .message.received .message-time {
            text-align: left;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 20px;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .typing-indicator.show {
            display: block;
        }

        /* Message Input */
        .message-input-container {
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        /* Voice Message Recording */
        .voice-recording {
            display: none;
            flex: 1;
            align-items: center;
            gap: 15px;
            padding: 10px 20px;
            background: var(--danger-color);
            color: white;
            border-radius: 25px;
            animation: pulse 1s infinite;
        }

        .voice-recording.show {
            display: flex;
        }

        .recording-indicator {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: recordingBlink 1s infinite;
        }

        @keyframes recordingBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .recording-duration {
            font-weight: 600;
            font-size: 14px;
        }

        /* Search Interface */
        .search-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .search-overlay.show {
            display: flex;
        }

        .search-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-input-overlay {
            flex: 1;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
        }

        .search-input-overlay::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-results {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .search-result-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .search-result-item:hover {
            background: var(--border-color);
        }

        .search-result-text {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .search-result-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Image Preview */
        .image-preview {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .image-preview.show {
            display: flex;
        }

        .image-preview img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }

        .image-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        /* Voice Message */
        .voice-message {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 15px;
            max-width: 200px;
        }

        .voice-play-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-color);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-waveform {
            flex: 1;
            height: 20px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .waveform-bar {
            width: 3px;
            background: var(--primary-color);
            border-radius: 2px;
            animation: waveform 1.5s ease-in-out infinite;
        }

        .waveform-bar:nth-child(2) { animation-delay: 0.1s; }
        .waveform-bar:nth-child(3) { animation-delay: 0.2s; }
        .waveform-bar:nth-child(4) { animation-delay: 0.3s; }
        .waveform-bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes waveform {
            0%, 100% { height: 4px; }
            50% { height: 16px; }
        }

        .voice-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Message Menu */
        .message-menu {
            position: absolute;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 10px 0;
            display: none;
            z-index: 100;
            min-width: 150px;
        }

        .message-menu.show {
            display: block;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background: var(--border-color);
        }

        .menu-item.danger {
            color: var(--danger-color);
        }

        .attachment-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .attachment-btn:hover {
            background: var(--border-color);
            color: var(--primary-color);
        }

        .message-input {
            flex: 1;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            max-height: 100px;
            resize: none;
        }

        .message-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .emoji-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-btn:hover {
            background: var(--border-color);
            color: var(--accent-color);
        }

        .voice-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: var(--border-color);
            color: var(--danger-color);
        }

        .voice-btn.recording {
            background: var(--danger-color);
            color: white;
            animation: pulse 1s infinite;
        }

        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .send-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .send-btn.sending {
            animation: pulse 1s infinite;
        }

        /* Message Status */
        .message-status {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .message.sent .message-status {
            justify-content: flex-end;
        }

        .message.received .message-status {
            justify-content: flex-start;
        }

        .status-icon {
            font-size: 8px;
        }

        .status-sent { color: var(--text-secondary); }
        .status-delivered { color: var(--primary-color); }
        .status-read { color: var(--accent-color); }

        /* Message Reactions */
        .message-reactions {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .reaction-btn {
            background: rgba(255,255,255,0.8);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            transform: scale(0.8);
        }

        .message:hover .reaction-btn {
            opacity: 1;
            transform: scale(1);
        }

        .reaction-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .message-reactions-display {
            display: flex;
            gap: 2px;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .reaction-emoji {
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 2px 4px;
            font-size: 10px;
            display: inline-block;
            animation: reactionPop 0.3s ease;
        }

        @keyframes reactionPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Enhanced Typing Indicator */
        .typing-container {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
        }

        .typing-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 12px;
        }

        .typing-bubble {
            background: var(--border-color);
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            position: relative;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out both;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.6;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }


        /* Improved animations */
        .message.sent {
            animation: slideInRight 0.3s ease-out;
        }

        .message.received {
            animation: slideInLeft 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Conversations List */
        .conversations-list {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--card-bg);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 5;
        }

        .conversations-list.show {
            transform: translateX(0);
        }

        .conversations-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .conversations-title {
            font-weight: 600;
        }

        .close-conversations {
            cursor: pointer;
            font-size: 18px;
        }

        .conversation-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .conversation-item:hover,
        .conversation-item.active {
            background: #f8fafc;
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 18px;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .conversation-last-message {
            font-size: 12px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .conversation-time {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .unread-badge {
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
        }

        /* Animations */
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typingDots {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .typing-dots span {
            display: inline-block;
            animation: typingDots 1.4s infinite ease-in-out both;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Dark Theme */
        .phone-screen.dark-theme {
            background: #1a1a1a;
            color: #ffffff;
        }

        .phone-screen.dark-theme .app-header {
            background: linear-gradient(135deg, #2d3748, #4a5568);
        }

        .phone-screen.dark-theme .messages-area {
            background: #1a1a1a;
        }

        .phone-screen.dark-theme .message.received .message-bubble {
            background: #2d3748;
            color: #ffffff;
        }

        .phone-screen.dark-theme .message.sent .message-bubble {
            background: linear-gradient(135deg, #4a5568, #718096);
        }

        .phone-screen.dark-theme .message-input-container {
            background: #2d3748;
            border-top-color: #4a5568;
        }

        .phone-screen.dark-theme .message-input {
            background: #1a202c;
            border-color: #4a5568;
            color: #ffffff;
        }

        .phone-screen.dark-theme .message-input::placeholder {
            color: #a0aec0;
        }

        .phone-screen.dark-theme .conversations-list {
            background: #1a1a1a;
        }

        .phone-screen.dark-theme .conversation-item {
            border-bottom-color: #2d3748;
        }

        .phone-screen.dark-theme .conversation-item:hover,
        .phone-screen.dark-theme .conversation-item.active {
            background: #2d3748;
        }

        .phone-screen.dark-theme .conversations-header {
            background: linear-gradient(135deg, #2d3748, #4a5568);
        }


        /* Call Interface */
        .call-interface {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            color: white;
        }

        .call-interface.show {
            display: flex;
        }

        /* Desktop Styles */
        @media (min-width: 768px) {
            .phone-container {
                margin: 40px auto;
            }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-notch">
            <div class="notch-speaker"></div>
        </div>
        <div class="phone-screen">
            <!-- App Header -->
            <div class="app-header">
                <i class="fas fa-arrow-left back-btn" id="backBtn"></i>
                <div class="contact-avatar" id="currentAvatar">JD</div>
                <div class="contact-info">
                    <div class="contact-name" id="currentName">John Doe</div>
                    <div class="contact-status" id="currentStatus">Online</div>
                </div>
                <div class="header-actions">
                    <i class="fas fa-search" id="searchBtn" title="Search messages"></i>
                    <i class="fas fa-phone" id="callBtn" title="Voice call"></i>
                    <i class="fas fa-video" id="videoBtn" title="Video call"></i>
                    <i class="fas fa-ellipsis-v" id="menuBtn" title="More options"></i>
                </div>
            </div>

            <!-- Conversations List -->
            <div class="conversations-list" id="conversationsList">
                <div class="conversations-header">
                    <div class="conversations-title">Chats</div>
                    <i class="fas fa-times close-conversations" id="closeConversations"></i>
                </div>
                <!-- Conversations will be populated by JavaScript -->
            </div>

            <!-- Search Overlay -->
            <div class="search-overlay" id="searchOverlay">
                <div class="search-header">
                    <i class="fas fa-arrow-left" id="closeSearch"></i>
                    <input type="text" class="search-input-overlay" id="searchInput" placeholder="Search messages...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="search-results" id="searchResults">
                    <!-- Search results will appear here -->
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-container" id="chatContainer">
                <!-- Messages Area -->
                <div class="messages-area" id="messagesArea">
                    <div class="typing-container" id="typingIndicator" style="display: none;">
                        <div class="typing-avatar">JD</div>
                        <div class="typing-bubble">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voice Recording UI -->
                <div class="voice-recording" id="voiceRecording">
                    <div class="recording-indicator"></div>
                    <span>Recording voice message...</span>
                    <span class="recording-duration" id="recordingDuration">00:00</span>
                    <button class="send-btn" id="sendVoiceBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>

                <!-- Message Input -->
                <div class="message-input-container" id="messageInputContainer">
                    <button class="attachment-btn" id="attachmentBtn" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <textarea class="message-input" id="messageInput" placeholder="Type a message..." maxlength="500" rows="1"></textarea>
                    <button class="voice-btn" id="voiceBtn" title="Voice message">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="send-btn" id="sendBtn" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview">
                <i class="fas fa-times image-preview-close" id="closeImagePreview"></i>
                <img id="previewImage" src="" alt="Preview">
            </div>

            <!-- Message Context Menu -->
            <div class="message-menu" id="messageMenu">
                <div class="menu-item" onclick="replyToMessage()">
                    <i class="fas fa-reply"></i>
                    Reply
                </div>
                <div class="menu-item" onclick="forwardMessage()">
                    <i class="fas fa-share"></i>
                    Forward
                </div>
                <div class="menu-item" onclick="copyMessage()">
                    <i class="fas fa-copy"></i>
                    Copy
                </div>
                <div class="menu-item" onclick="deleteMessage()">
                    <i class="fas fa-trash"></i>
                    Delete
                </div>
                <div class="menu-item danger" onclick="reportMessage()">
                    <i class="fas fa-flag"></i>
                    Report
                </div>
            </div>


            <!-- Call Interface -->
            <div class="call-interface" id="callInterface">
                <div class="call-header">
                    <div class="call-avatar" id="callAvatar">JD</div>
                    <div class="call-name" id="callName">John Doe</div>
                    <div class="call-status" id="callStatus">Calling...</div>
                    <div class="call-timer" id="callTimer">00:00</div>
                </div>

                <div class="call-video-area" id="callVideoArea">
                    <div class="remote-video" id="remoteVideo">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="local-video" id="localVideo">
                        <i class="fas fa-user"></i>
                    </div>
                </div>

                <div class="call-controls">
                    <button class="call-btn mute" id="muteBtn" title="Mute">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="call-btn speaker" id="speakerBtn" title="Speaker">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button class="call-btn video" id="videoBtnCall" title="Video">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="call-btn hangup" id="hangupBtn" title="End Call">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data for conversations and messages
        const conversations = [
            {
                id: 1,
                name: "John Doe",
                avatar: "JD",
                status: "Online",
                lastMessage: "Hey! How are you doing?",
                time: "2 min ago",
                unread: 0,
                messages: [
                    { id: 1, text: "Hey! How are you doing?", sender: "received", time: "10:30 AM", reactions: [] },
                    { id: 2, text: "I'm doing great! Just working on some new projects. How about you?", sender: "sent", time: "10:32 AM", status: "read", reactions: [] },
                    { id: 3, text: "That sounds awesome! I'm good too, just finished a mobile app design.", sender: "received", time: "10:33 AM", reactions: [] },
                    { id: 4, text: "Mobile apps are my passion! What kind of app are you working on?", sender: "sent", time: "10:35 AM", status: "read", reactions: [] },
                    { id: 5, text: "It's a chat application actually! Very similar to what we're using now 😊", sender: "received", time: "10:36 AM", reactions: [{ emoji: "👍", user: "You" }] },
                    { id: 6, type: "voice", duration: 5, sender: "sent", time: "10:38 AM", status: "read" },
                    { id: 7, text: "That sounds amazing! Can you show me some screenshots?", sender: "received", time: "10:39 AM", reactions: [] },
                    { id: 8, type: "image", imageUrl: "https://images.unsplash.com/photo-1551650975-87deedd944c3?w=300&h=200&fit=crop", text: "Here's a preview of the design! 📱", sender: "received", time: "10:40 AM", reactions: [] }
                ]
            },
            {
                id: 2,
                name: "Sarah Wilson",
                avatar: "SW",
                status: "Last seen 5 min ago",
                lastMessage: "Thanks for the help with the code!",
                time: "5 min ago",
                unread: 2,
                messages: [
                    { id: 1, text: "Hi Sarah! Did you get that bug fixed?", sender: "sent", time: "9:15 AM", status: "read", reactions: [] },
                    { id: 2, text: "Yes! Thanks for the help with the code! You're amazing!", sender: "received", time: "9:20 AM", reactions: [{ emoji: "❤️", user: "You" }] },
                    { id: 3, text: "No problem at all! Happy to help 😊", sender: "sent", time: "9:22 AM", status: "read", reactions: [] },
                    { id: 4, text: "By the way, have you seen the new React features?", sender: "received", time: "9:25 AM", reactions: [] }
                ]
            },
            {
                id: 3,
                name: "Mike Johnson",
                avatar: "MJ",
                status: "Typing...",
                lastMessage: "Let's meet tomorrow at 3 PM",
                time: "1 hour ago",
                unread: 1,
                messages: [
                    { id: 1, text: "Hey Mike, are you free tomorrow?", sender: "sent", time: "Yesterday 4:00 PM" },
                    { id: 2, text: "Yes, I should be free. What time were you thinking?", sender: "received", time: "Yesterday 4:05 PM" },
                    { id: 3, text: "How about 3 PM? We can discuss the project details.", sender: "sent", time: "Yesterday 4:10 PM" },
                    { id: 4, text: "Perfect! Let's meet tomorrow at 3 PM", sender: "received", time: "Yesterday 4:12 PM" }
                ]
            },
            {
                id: 4,
                name: "Emily Davis",
                avatar: "ED",
                status: "Online",
                lastMessage: "The design looks great! 👍",
                time: "2 hours ago",
                unread: 0,
                messages: [
                    { id: 1, text: "Emily, I finished the UI mockups for the new feature.", sender: "sent", time: "Yesterday 2:00 PM" },
                    { id: 2, text: "Let me take a look... The design looks great! 👍", sender: "received", time: "Yesterday 2:15 PM" },
                    { id: 3, text: "Thanks! I spent a lot of time perfecting the user experience.", sender: "sent", time: "Yesterday 2:20 PM" },
                    { id: 4, text: "It really shows. The attention to detail is impressive!", sender: "received", time: "Yesterday 2:25 PM" }
                ]
            }
        ];

        let currentConversationId = 1;
        let isTyping = false;
        let isRecording = false;
        let recordingStartTime = 0;
        let recordingInterval = null;
        let selectedMessageId = null;
        let isSearchMode = false;

        // Call functionality variables
        let currentCall = null;
        let callTimer = null;
        let callStartTime = 0;
        let isCallActive = false;
        let isMuted = false;
        let isSpeakerOn = false;
        let isVideoOn = false;
        let callType = 'audio'; // 'audio' or 'video'

        // DOM Elements
        const backBtn = document.getElementById('backBtn');
        const conversationsList = document.getElementById('conversationsList');
        const chatContainer = document.getElementById('chatContainer');
        const closeConversations = document.getElementById('closeConversations');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const messagesArea = document.getElementById('messagesArea');
        const typingIndicator = document.getElementById('typingIndicator');
        const currentName = document.getElementById('currentName');
        const currentAvatar = document.getElementById('currentAvatar');
        const currentStatus = document.getElementById('currentStatus');

        // New DOM Elements
        const searchBtn = document.getElementById('searchBtn');
        const searchOverlay = document.getElementById('searchOverlay');
        const closeSearch = document.getElementById('closeSearch');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const callBtn = document.getElementById('callBtn');
        const videoBtn = document.getElementById('videoBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const voiceRecording = document.getElementById('voiceRecording');
        const recordingDuration = document.getElementById('recordingDuration');
        const sendVoiceBtn = document.getElementById('sendVoiceBtn');
        const messageInputContainer = document.getElementById('messageInputContainer');
        const imagePreview = document.getElementById('imagePreview');
        const closeImagePreview = document.getElementById('closeImagePreview');
        const previewImage = document.getElementById('previewImage');
        const messageMenu = document.getElementById('messageMenu');
        const attachmentBtn = document.getElementById('attachmentBtn');

        // Call interface elements
        const callInterface = document.getElementById('callInterface');
        const callAvatar = document.getElementById('callAvatar');
        const callName = document.getElementById('callName');
        const callStatus = document.getElementById('callStatus');
        const callTimerEl = document.getElementById('callTimer');
        const callVideoArea = document.getElementById('callVideoArea');
        const remoteVideo = document.getElementById('remoteVideo');
        const localVideo = document.getElementById('localVideo');
        const muteBtn = document.getElementById('muteBtn');
        const speakerBtn = document.getElementById('speakerBtn');
        const videoBtnCall = document.getElementById('videoBtnCall');
        const hangupBtn = document.getElementById('hangupBtn');

        // Initialize the app
        function initApp() {
            loadConversations();
            loadConversation(currentConversationId);
            setupEventListeners();
        }

        // Load conversations list
        function loadConversations() {
            const conversationsContainer = document.createElement('div');
            conversationsContainer.id = 'conversationsContainer';

            conversations.forEach(conv => {
                const conversationEl = document.createElement('div');
                conversationEl.className = `conversation-item ${conv.id === currentConversationId ? 'active' : ''}`;
                conversationEl.onclick = () => switchConversation(conv.id);

                conversationEl.innerHTML = `
                    <div class="conversation-avatar">${conv.avatar}</div>
                    <div class="conversation-info">
                        <div class="conversation-name">${conv.name}</div>
                        <div class="conversation-last-message">${conv.lastMessage}</div>
                    </div>
                    <div class="conversation-meta">
                        <div class="conversation-time">${conv.time}</div>
                        ${conv.unread > 0 ? `<div class="unread-badge">${conv.unread}</div>` : ''}
                    </div>
                `;

                conversationsContainer.appendChild(conversationEl);
            });

            conversationsList.appendChild(conversationsContainer);
        }

        // Load conversation messages
        function loadConversation(conversationId) {
            const conversation = conversations.find(c => c.id === conversationId);
            if (!conversation) return;

            // Update header
            currentName.textContent = conversation.name;
            currentAvatar.textContent = conversation.avatar;
            currentStatus.textContent = conversation.status;

            // Clear messages
            messagesArea.innerHTML = '';

            // Load messages
            conversation.messages.forEach(message => {
                addMessageToUI(message);
            });

            // Scroll to bottom
            scrollToBottom();

            // Simulate typing indicator occasionally
            if (Math.random() > 0.7) {
                showTypingIndicator();
            }
        }

        // Add message to UI
        function addMessageToUI(message) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${message.sender}`;
            messageEl.dataset.messageId = message.id;

            const statusClass = message.sender === 'sent' ? getMessageStatus(message.status) : '';
            const statusIcon = message.sender === 'sent' ? getStatusIcon(message.status) : '';

            messageEl.innerHTML = `
                <div class="message-bubble">
                    ${message.text}
                    <div class="message-reactions">
                        <button class="reaction-btn" onclick="addReaction('${message.id}', '❤️')">👍</button>
                        <button class="reaction-btn" onclick="addReaction('${message.id}', '❤️')">❤️</button>
                        <button class="reaction-btn" onclick="addReaction('${message.id}', '😂')">😂</button>
                        <button class="reaction-btn" onclick="addReaction('${message.id}', '😮')">😮</button>
                    </div>
                </div>
                <div class="message-time">${message.time}</div>
                ${message.sender === 'sent' ? `<div class="message-status ${statusClass}">${statusIcon}</div>` : ''}
            `;

            messagesArea.appendChild(messageEl);

            // Add reactions display if any
            if (message.reactions && message.reactions.length > 0) {
                const reactionsEl = document.createElement('div');
                reactionsEl.className = 'message-reactions-display';
                reactionsEl.innerHTML = message.reactions.map(r => `<span class="reaction-emoji">${r.emoji}</span>`).join('');
                messageEl.querySelector('.message-bubble').appendChild(reactionsEl);
            }
        }

        // Send message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            const message = {
                id: Date.now(),
                text: text,
                sender: 'sent',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                status: 'sent',
                reactions: []
            };

            // Add to current conversation
            const conversation = conversations.find(c => c.id === currentConversationId);
            conversation.messages.push(message);
            conversation.lastMessage = text;
            conversation.time = 'now';

            // Add to UI
            addMessageToUI(message);
            scrollToBottom();

            // Clear input and reset height
            messageInput.value = '';
            messageInput.style.height = 'auto';
            messageInput.rows = 1;
            sendBtn.disabled = true;

            // Play send sound
            playSound('send');

            // Update status to delivered after a delay
            setTimeout(() => {
                updateMessageStatus(message.id, 'delivered');
            }, 500);

            // Update status to read after another delay
            setTimeout(() => {
                updateMessageStatus(message.id, 'read');
            }, 2000);

            // Simulate reply after a delay
            setTimeout(() => {
                simulateReply();
            }, 1000 + Math.random() * 2000);
        }

        // Simulate reply from other user
        function simulateReply() {
            const replies = [
                "That sounds interesting! Tell me more.",
                "I completely agree with you.",
                "Thanks for sharing that information.",
                "That's a great point!",
                "I hadn't thought of it that way.",
                "Absolutely! Let's discuss this further.",
                "I'm glad you brought that up.",
                "That's really helpful, thank you!",
                "I see what you mean now.",
                "Great idea! How can we implement this?"
            ];

            const randomReply = replies[Math.floor(Math.random() * replies.length)];

            const message = {
                id: Date.now(),
                text: randomReply,
                sender: 'received',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };

            // Add to current conversation
            const conversation = conversations.find(c => c.id === currentConversationId);
            conversation.messages.push(message);
            conversation.lastMessage = randomReply;
            conversation.time = 'now';

            // Show typing indicator first
            showTypingIndicator();

            // Add message after typing delay
            setTimeout(() => {
                hideTypingIndicator();
                addMessageToUI(message);
                scrollToBottom();
            }, 2000);
        }

        // Show typing indicator
        function showTypingIndicator() {
            const avatar = typingIndicator.querySelector('.typing-avatar');
            const currentContact = conversations.find(c => c.id === currentConversationId);
            avatar.textContent = currentContact.avatar;
            typingIndicator.style.display = 'flex';
            scrollToBottom();
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }


        // Switch conversation
        function switchConversation(conversationId) {
            currentConversationId = conversationId;

            // Update active conversation
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Hide conversations list
            conversationsList.classList.remove('show');

            // Load new conversation
            loadConversation(conversationId);
        }

        // Scroll to bottom of messages
        function scrollToBottom() {
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Message status helper functions
        function getMessageStatus(status) {
            return `status-${status}`;
        }

        function getStatusIcon(status) {
            const icons = {
                sent: '<i class="fas fa-check status-icon"></i>',
                delivered: '<i class="fas fa-check-double status-icon"></i>',
                read: '<i class="fas fa-check-double status-icon"></i>'
            };
            return icons[status] || '';
        }

        function updateMessageStatus(messageId, status) {
            const message = document.querySelector(`[data-message-id="${messageId}"]`);
            if (message) {
                const statusEl = message.querySelector('.message-status');
                if (statusEl) {
                    statusEl.className = `message-status ${getMessageStatus(status)}`;
                    statusEl.innerHTML = getStatusIcon(status);
                }
            }
        }

        // Add reaction to message
        function addReaction(messageId, emoji) {
            const message = conversations.find(c => c.id === currentConversationId)
                .messages.find(m => m.id == messageId);

            if (message) {
                if (!message.reactions) message.reactions = [];
                message.reactions.push({ emoji, user: 'You' });

                // Update UI
                const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
                if (messageEl) {
                    let reactionsEl = messageEl.querySelector('.message-reactions-display');
                    if (!reactionsEl) {
                        reactionsEl = document.createElement('div');
                        reactionsEl.className = 'message-reactions-display';
                        messageEl.querySelector('.message-bubble').appendChild(reactionsEl);
                    }
                    reactionsEl.innerHTML = message.reactions.map(r => `<span class="reaction-emoji">${r.emoji}</span>`).join('');
                }
            }
        }

        // Sound effects
        function playSound(type) {
            // Create audio context for sound effects
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                if (type === 'send') {
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                }
            } catch (e) {
                // Fallback: no sound on older browsers
            }
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            messageInput.style.height = 'auto';
            const scrollHeight = messageInput.scrollHeight;
            messageInput.style.height = Math.min(scrollHeight, 100) + 'px';
            messageInput.rows = Math.min(Math.ceil(scrollHeight / 20), 5);
        }

        // Voice recording functions
        function startVoiceRecording() {
            isRecording = true;
            recordingStartTime = Date.now();
            voiceBtn.classList.add('recording');
            messageInputContainer.style.display = 'none';
            voiceRecording.classList.add('show');

            recordingInterval = setInterval(() => {
                const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                recordingDuration.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);

            playSound('recording');
        }

        function stopVoiceRecording() {
            if (!isRecording) return;

            isRecording = false;
            clearInterval(recordingInterval);
            voiceBtn.classList.remove('recording');
            voiceRecording.classList.remove('show');
            messageInputContainer.style.display = 'flex';

            const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
            if (duration > 1) { // Only send if recording is longer than 1 second
                sendVoiceMessage(duration);
            }
        }

        function sendVoiceMessage(duration) {
            const message = {
                id: Date.now(),
                type: 'voice',
                duration: duration,
                sender: 'sent',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                status: 'sent'
            };

            const conversation = conversations.find(c => c.id === currentConversationId);
            conversation.messages.push(message);
            conversation.lastMessage = 'Voice message';
            conversation.time = 'now';

            addMessageToUI(message);
            scrollToBottom();

            setTimeout(() => updateMessageStatus(message.id, 'delivered'), 500);
            setTimeout(() => updateMessageStatus(message.id, 'read'), 2000);
        }

        // Search functionality
        function openSearch() {
            searchOverlay.classList.add('show');
            searchInput.focus();
            isSearchMode = true;
        }

        function closeSearchMode() {
            searchOverlay.classList.remove('show');
            searchInput.value = '';
            searchResults.innerHTML = '';
            isSearchMode = false;
        }

        function performSearch() {
            const query = searchInput.value.toLowerCase().trim();
            if (!query) {
                searchResults.innerHTML = '';
                return;
            }

            const conversation = conversations.find(c => c.id === currentConversationId);
            const results = conversation.messages.filter(msg =>
                msg.text && msg.text.toLowerCase().includes(query)
            );

            searchResults.innerHTML = results.map(msg => `
                <div class="search-result-item" onclick="jumpToMessage(${msg.id})">
                    <div class="search-result-text">${highlightSearchTerm(msg.text, query)}</div>
                    <div class="search-result-meta">${msg.sender === 'sent' ? 'You' : currentName.textContent} • ${msg.time}</div>
                </div>
            `).join('');
        }

        function highlightSearchTerm(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function jumpToMessage(messageId) {
            closeSearchMode();
            const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageEl) {
                messageEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                messageEl.style.background = 'rgba(99, 102, 241, 0.2)';
                setTimeout(() => {
                    messageEl.style.background = '';
                }, 2000);
            }
        }

        // Message context menu
        function showMessageMenu(messageId, event) {
            selectedMessageId = messageId;
            const rect = event.target.getBoundingClientRect();
            messageMenu.style.left = `${rect.left}px`;
            messageMenu.style.top = `${rect.bottom + 10}px`;
            messageMenu.classList.add('show');
        }

        function hideMessageMenu() {
            messageMenu.classList.remove('show');
            selectedMessageId = null;
        }

        function replyToMessage() {
            const message = findMessageById(selectedMessageId);
            if (message) {
                messageInput.value = `Replying to: "${message.text}"\n`;
                messageInput.focus();
                sendBtn.disabled = false;
            }
            hideMessageMenu();
        }

        function forwardMessage() {
            const message = findMessageById(selectedMessageId);
            if (message) {
                alert(`Message "${message.text}" would be forwarded to another chat in a real app!`);
            }
            hideMessageMenu();
        }

        function copyMessage() {
            const message = findMessageById(selectedMessageId);
            if (message) {
                navigator.clipboard.writeText(message.text).then(() => {
                    showNotification('Message copied to clipboard!', 'success');
                });
            }
            hideMessageMenu();
        }

        function deleteMessage() {
            if (confirm('Delete this message?')) {
                const conversation = conversations.find(c => c.id === currentConversationId);
                conversation.messages = conversation.messages.filter(m => m.id != selectedMessageId);
                loadConversation(currentConversationId);
                showNotification('Message deleted', 'info');
            }
            hideMessageMenu();
        }

        function reportMessage() {
            alert('Message reported! This would be sent to moderators in a real app.');
            hideMessageMenu();
        }

        function findMessageById(messageId) {
            const conversation = conversations.find(c => c.id === currentConversationId);
            return conversation.messages.find(m => m.id == messageId);
        }

        // Image preview
        function showImagePreview(src) {
            previewImage.src = src;
            imagePreview.classList.add('show');
        }

        function hideImagePreview() {
            imagePreview.classList.remove('show');
        }

        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas ${getNotificationIcon(type)}"></i>
                ${message}
            `;

            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${getNotificationColor(type)};
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 10px;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            return icons[type] || 'fa-info-circle';
        }

        function getNotificationColor(type) {
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#6366f1'
            };
            return colors[type] || '#6366f1';
        }

        // Enhanced message display for different types
        function addMessageToUI(message) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${message.sender}`;
            messageEl.dataset.messageId = message.id;

            let messageContent = '';

            if (message.type === 'voice') {
                messageContent = `
                    <div class="message-bubble">
                        <div class="voice-message">
                            <button class="voice-play-btn" onclick="playVoiceMessage(${message.id})">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="voice-waveform">
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                                <div class="waveform-bar"></div>
                            </div>
                            <span class="voice-duration">${formatDuration(message.duration)}</span>
                        </div>
                    </div>
                `;
            } else if (message.type === 'image') {
                messageContent = `
                    <div class="message-bubble">
                        <img src="${message.imageUrl}" alt="Shared image" style="max-width: 200px; border-radius: 10px; cursor: pointer;" onclick="showImagePreview('${message.imageUrl}')">
                        ${message.text ? `<div style="margin-top: 8px;">${message.text}</div>` : ''}
                    </div>
                `;
            } else {
                messageContent = `
                    <div class="message-bubble">
                        ${message.text}
                        <div class="message-reactions">
                            <button class="reaction-btn" onclick="addReaction('${message.id}', '❤️')">👍</button>
                            <button class="reaction-btn" onclick="addReaction('${message.id}', '❤️')">❤️</button>
                            <button class="reaction-btn" onclick="addReaction('${message.id}', '😂')">😂</button>
                            <button class="reaction-btn" onclick="addReaction('${message.id}', '😮')">😮</button>
                        </div>
                    </div>
                `;
            }

            const statusClass = message.sender === 'sent' && message.status ? `status-${message.status}` : '';
            const statusIcon = message.sender === 'sent' && message.status ? getStatusIcon(message.status) : '';

            messageEl.innerHTML = `
                ${messageContent}
                <div class="message-time">${message.time}</div>
                ${message.sender === 'sent' ? `<div class="message-status ${statusClass}">${statusIcon}</div>` : ''}
            `;

            // Add context menu for sent messages
            if (message.sender === 'sent') {
                messageEl.oncontextmenu = (e) => {
                    e.preventDefault();
                    showMessageMenu(message.id, e);
                };
            }

            messagesArea.appendChild(messageEl);

            // Add reactions display if any
            if (message.reactions && message.reactions.length > 0) {
                const reactionsEl = document.createElement('div');
                reactionsEl.className = 'message-reactions-display';
                reactionsEl.innerHTML = message.reactions.map(r => `<span class="reaction-emoji">${r.emoji}</span>`).join('');
                messageEl.querySelector('.message-bubble').appendChild(reactionsEl);
            }
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function playVoiceMessage(messageId) {
            const message = findMessageById(messageId);
            if (message) {
                showNotification('Voice message playback would start here!', 'info');
            }
        }

        function sendImageMessage(imageUrl, caption = '') {
            const message = {
                id: Date.now(),
                type: 'image',
                imageUrl: imageUrl,
                text: caption,
                sender: 'sent',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                status: 'sent'
            };

            const conversation = conversations.find(c => c.id === currentConversationId);
            conversation.messages.push(message);
            conversation.lastMessage = caption || 'Photo';
            conversation.time = 'now';

            addMessageToUI(message);
            scrollToBottom();

            setTimeout(() => updateMessageStatus(message.id, 'delivered'), 500);
            setTimeout(() => updateMessageStatus(message.id, 'read'), 2000);

            showNotification('Image sent!', 'success');
        }

        // Call functionality
        function startAudioCall() {
            const conversation = conversations.find(c => c.id === currentConversationId);
            initiateCall(conversation, 'audio');
        }

        function startVideoCall() {
            const conversation = conversations.find(c => c.id === currentConversationId);
            initiateCall(conversation, 'video');
        }

        function initiateCall(conversation, type) {
            currentCall = conversation;
            callType = type;

            // Update call interface
            callAvatar.textContent = conversation.avatar;
            callName.textContent = conversation.name;
            callStatus.textContent = 'Calling...';
            callStatus.className = 'call-status call-ringing';
            callTimerEl.textContent = '00:00';

            // Show/hide video area
            if (type === 'video') {
                callVideoArea.classList.add('show');
                isVideoOn = true;
                videoBtnCall.innerHTML = '<i class="fas fa-video"></i>';
                videoBtnCall.classList.remove('off');
            } else {
                callVideoArea.classList.remove('show');
                isVideoOn = false;
            }

            // Show call interface
            callInterface.classList.add('show', 'ringing');

            // Simulate call pickup after 2-4 seconds
            const pickupDelay = 2000 + Math.random() * 2000;
            setTimeout(() => {
                acceptCall();
            }, pickupDelay);
        }

        function acceptCall() {
            isCallActive = true;
            callStatus.textContent = 'Connected';
            callStatus.className = 'call-status call-connected';
            callInterface.classList.remove('ringing');
            callInterface.classList.add('call-connected');

            callStartTime = Date.now();

            // Start call timer
            callTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                callTimerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);

            showNotification('Call connected', 'success');
        }

        function endCall() {
            if (callTimer) {
                clearInterval(callTimer);
            }

            isCallActive = false;
            callStatus.textContent = 'Call ended';
            callStatus.className = 'call-status call-ended';
            callInterface.classList.remove('call-connected', 'ringing');

            // Reset call states
            isMuted = false;
            isSpeakerOn = false;
            isVideoOn = false;

            // Update button states
            muteBtn.classList.remove('muted');
            speakerBtn.classList.remove('active');
            videoBtnCall.classList.remove('off');

            // Hide call interface after a delay
            setTimeout(() => {
                callInterface.classList.remove('show');
                currentCall = null;
            }, 2000);

            showNotification('Call ended', 'info');
        }

        function toggleMute() {
            isMuted = !isMuted;
            muteBtn.classList.toggle('muted');
            const icon = muteBtn.querySelector('i');
            if (isMuted) {
                icon.className = 'fas fa-microphone-slash';
                showNotification('Microphone muted', 'info');
            } else {
                icon.className = 'fas fa-microphone';
                showNotification('Microphone unmuted', 'success');
            }
        }

        function toggleSpeaker() {
            isSpeakerOn = !isSpeakerOn;
            speakerBtn.classList.toggle('active');
            const icon = speakerBtn.querySelector('i');
            if (isSpeakerOn) {
                icon.className = 'fas fa-volume-up';
                showNotification('Speaker on', 'success');
            } else {
                icon.className = 'fas fa-volume-down';
                showNotification('Speaker off', 'info');
            }
        }

        function toggleVideo() {
            if (callType === 'audio') return; // No video toggle for audio calls

            isVideoOn = !isVideoOn;
            videoBtnCall.classList.toggle('off');
            const icon = videoBtnCall.querySelector('i');

            if (isVideoOn) {
                icon.className = 'fas fa-video';
                callVideoArea.classList.add('show');
                showNotification('Video on', 'success');
            } else {
                icon.className = 'fas fa-video-slash';
                callVideoArea.classList.remove('show');
                showNotification('Video off', 'info');
            }
        }


        // Setup event listeners
        function setupEventListeners() {
            // Back button
            backBtn.onclick = () => {
                conversationsList.classList.add('show');
            };

            // Close conversations
            closeConversations.onclick = () => {
                conversationsList.classList.remove('show');
            };

            // Search functionality
            searchBtn.onclick = openSearch;
            closeSearch.onclick = closeSearchMode;
            searchInput.oninput = performSearch;

            // Call functionality
            callBtn.onclick = startAudioCall;
            videoBtn.onclick = startVideoCall;
            muteBtn.onclick = toggleMute;
            speakerBtn.onclick = toggleSpeaker;
            videoBtnCall.onclick = toggleVideo;
            hangupBtn.onclick = endCall;

            // Message input
            messageInput.oninput = () => {
                sendBtn.disabled = messageInput.value.trim().length === 0;
                autoResizeTextarea();
            };

            messageInput.onkeypress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            // Send button
            sendBtn.onclick = sendMessage;

            // Voice recording
            voiceBtn.onmousedown = startVoiceRecording;
            voiceBtn.onmouseup = stopVoiceRecording;
            voiceBtn.onmouseleave = stopVoiceRecording; // Handle mouse leaving button
            sendVoiceBtn.onclick = () => {
                stopVoiceRecording();
                sendVoiceMessage(parseInt(recordingDuration.textContent.split(':')[0]) * 60 + parseInt(recordingDuration.textContent.split(':')[1]));
            };


            // Attachment button
            attachmentBtn.onclick = () => {
                // Simulate image sharing
                const imageUrl = 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=300&h=200&fit=crop';
                sendImageMessage(imageUrl, 'Check out this beautiful landscape! 🏞️');
            };


            // Image preview
            closeImagePreview.onclick = hideImagePreview;
            imagePreview.onclick = (e) => {
                if (e.target === imagePreview) {
                    hideImagePreview();
                }
            };

            // Close message menu when clicking elsewhere
            document.onclick = (e) => {
                if (!messageMenu.contains(e.target) && !e.target.closest('.message-bubble')) {
                    hideMessageMenu();
                }
            };

            // Auto-resize on load
            autoResizeTextarea();
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>