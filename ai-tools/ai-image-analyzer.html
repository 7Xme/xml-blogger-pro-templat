<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Analyzer</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .analyzer-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .upload-section {
            margin-bottom: 30px;
            text-align: center;
        }
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            margin-bottom: 20px;
        }
        .upload-area:hover, .upload-area.dragover {
            border-color: #dc143c;
            background: #fff5f5;
        }
        .upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .upload-icon {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
        .upload-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        .upload-subtext {
            font-size: 14px;
            color: #999;
        }
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            display: none;
            margin: 20px auto;
        }
        .analysis-options {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .option-group {
            margin-bottom: 20px;
        }
        .option-group h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }
        .option-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        .control-group label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .control-group select, .control-group textarea {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .control-group select:focus, .control-group textarea:focus {
            outline: none;
            border-color: #dc143c;
        }
        .control-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        .analyze-btn {
            background: #dc143c;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
        }
        .analyze-btn:hover {
            background: #b22222;
            transform: scale(1.05);
        }
        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc143c, #ff6b6b);
            width: 0%;
            transition: width 0.3s ease;
        }
        .analysis-result {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            display: none;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .result-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        .result-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-btn {
            background: #e9ecef;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            background: #dc143c;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .description-content, .ocr-content {
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
        }
        .ocr-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            border: 1px solid #e9ecef;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .copy-btn, .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        .copy-btn:hover, .download-btn:hover {
            background: #218838;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }
        @media (max-width: 768px) {
            .analyzer-container {
                padding: 20px;
            }
            .upload-area {
                padding: 30px 20px;
            }
            .option-controls {
                grid-template-columns: 1fr;
            }
            .action-buttons {
                flex-direction: column;
            }
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="analyzer-container">
        <h1>ü§ñ AI Image Analyzer</h1>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <input type="file" id="imageFile" accept="image/*">
                <div class="upload-icon">üñºÔ∏è</div>
                <div class="upload-text">Drop image here or click to browse</div>
                <div class="upload-subtext">Supports PNG, JPG, JPEG, GIF, WebP (max 10MB)</div>
            </div>

            <img id="imagePreview" class="image-preview" alt="Preview">
        </div>

        <div class="analysis-options" id="analysisOptions" style="display: none;">
            <div class="option-group">
                <h3>Analysis Settings</h3>
                <div class="option-controls">
                    <div class="control-group">
                        <label for="analysisType">Analysis Type</label>
                        <select id="analysisType">
                            <option value="comprehensive">Comprehensive Analysis</option>
                            <option value="description">Image Description Only</option>
                            <option value="ocr">Text Extraction Only</option>
                            <option value="objects">Object Detection</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="detailLevel">Detail Level</label>
                        <select id="detailLevel">
                            <option value="brief">Brief</option>
                            <option value="detailed" selected>Detailed</option>
                            <option value="comprehensive">Comprehensive</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="option-group">
                <h3>Custom Prompt (Optional)</h3>
                <div class="control-group">
                    <textarea id="customPrompt" placeholder="e.g., 'Describe this image in detail, focusing on colors and composition' or 'Extract all visible text from this image'"></textarea>
                </div>
            </div>

            <div class="option-group">
                <p style="font-size: 12px; color: #666; margin: 0; text-align: center;">
                    üéØ Powered by FREE Gemini 2.0 Flash Vision | Advanced image understanding & OCR
                </p>
            </div>

            <button class="analyze-btn" id="analyzeBtn" onclick="analyzeImage()">Analyze Image</button>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div style="text-align: center; margin-top: 10px; color: #666;" id="progressText">Analyzing image with AI...</div>
        </div>

        <div class="analysis-result" id="analysisResult">
            <div class="result-header">
                <div class="result-title">AI Analysis Results</div>
                <div class="result-tabs">
                    <button class="tab-btn active" onclick="switchTab('description')">Description</button>
                    <button class="tab-btn" onclick="switchTab('ocr')">Extracted Text</button>
                </div>
            </div>

            <div id="descriptionTab" class="tab-content active">
                <div class="description-content" id="descriptionContent"></div>
            </div>

            <div id="ocrTab" class="tab-content">
                <div class="ocr-content" id="ocrContent">No text detected in the image.</div>
            </div>

            <div class="action-buttons">
                <button class="copy-btn" onclick="copyResults()">üìã Copy Results</button>
                <button class="download-btn" onclick="downloadResults()">üíæ Download Analysis</button>
            </div>
        </div>

        <div class="status" id="status"></div>
    </div>

    <script>
        let currentImageFile = null;
        let analysisResults = {
            description: '',
            ocr: ''
        };

        // DOM elements
        const imageFile = document.getElementById('imageFile');
        const uploadArea = document.getElementById('uploadArea');
        const imagePreview = document.getElementById('imagePreview');
        const analysisOptions = document.getElementById('analysisOptions');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const analysisResult = document.getElementById('analysisResult');
        const descriptionContent = document.getElementById('descriptionContent');
        const ocrContent = document.getElementById('ocrContent');
        const statusDiv = document.getElementById('status');

        // Gemini API setup
        const GEMINI_API_KEY = 'AIzaSyBpHEyNvPqizvETCBhfaldxp3FZMUEnfGY';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        // Event listeners
        imageFile.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleFileDrop);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showStatus('Image file size must be under 10MB. Please choose a smaller file.', 'error');
                    return;
                }
                processImage(file);
            } else {
                showStatus('Please select a valid image file.', 'error');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            uploadArea.classList.remove('dragover');

            const file = event.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                if (file.size > 10 * 1024 * 1024) {
                    showStatus('Image file size must be under 10MB. Please choose a smaller file.', 'error');
                    return;
                }
                processImage(file);
                imageFile.files = event.dataTransfer.files;
            } else {
                showStatus('Please drop a valid image file.', 'error');
            }
        }

        function processImage(file) {
            currentImageFile = file;

            // Show image preview
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Show analysis options
            analysisOptions.style.display = 'block';
            analysisResult.style.display = 'none';

            showStatus(`Image "${file.name}" ready for AI analysis. Click "Analyze Image" to begin.`, 'success');
        }

        async function analyzeImage() {
            if (!currentImageFile) {
                showStatus('‚ùå Please select an image first.', 'error');
                return;
            }

            // Show processing state
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'üß† Analyzing...';
            analysisResult.style.display = 'none';

            try {
                const analysisType = document.getElementById('analysisType').value;
                const detailLevel = document.getElementById('detailLevel').value;
                const customPrompt = document.getElementById('customPrompt').value.trim();

                // Update progress
                setTimeout(() => {
                    progressFill.style.width = '30%';
                    progressText.textContent = 'Processing image...';
                }, 500);

                const results = await analyzeImageWithAI(currentImageFile, analysisType, detailLevel, customPrompt);

                // Update progress to complete
                progressFill.style.width = '100%';
                progressText.textContent = 'Analysis complete!';

                setTimeout(() => {
                    displayResults(results);
                    progressContainer.style.display = 'none';
                    analyzeBtn.disabled = false;
                    analyzeBtn.textContent = 'Analyze Image';
                }, 1000);

            } catch (error) {
                console.error('Analysis error:', error);
                progressContainer.style.display = 'none';
                showStatus('‚ùå Error: ' + (error.message || 'Failed to analyze image. Please try again.'), 'error');
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze Image';
            }
        }

        async function analyzeImageWithAI(imageFile, analysisType, detailLevel, customPrompt) {
            try {
                // Convert image to base64
                const base64Image = await fileToBase64(imageFile);

                // Create appropriate prompt based on analysis type
                let prompt = '';

                if (customPrompt) {
                    prompt = customPrompt;
                } else {
                    switch (analysisType) {
                        case 'comprehensive':
                            prompt = `Analyze this image comprehensively. Provide:
1. A detailed description of what you see
2. Any text visible in the image (extract it exactly)
3. Objects, people, or elements present
4. Colors, lighting, and composition
5. Context or setting if discernible

${detailLevel === 'brief' ? 'Keep the description concise.' : detailLevel === 'comprehensive' ? 'Be extremely thorough and detailed.' : 'Provide a balanced, detailed analysis.'}`;
                            break;
                        case 'description':
                            prompt = `Describe this image in detail. Include visual elements, colors, composition, and any notable features. ${detailLevel === 'brief' ? 'Keep it brief.' : detailLevel === 'comprehensive' ? 'Be extremely thorough.' : 'Provide a balanced description.'}`;
                            break;
                        case 'ocr':
                            prompt = `Extract all visible text from this image. Return only the text exactly as it appears, maintaining formatting and line breaks where possible. If no text is visible, say "No text detected."`;
                            break;
                        case 'objects':
                            prompt = `Identify and list all objects, people, animals, or elements visible in this image. ${detailLevel === 'brief' ? 'Keep it concise.' : detailLevel === 'comprehensive' ? 'Be very detailed about each element.' : 'Provide a balanced list.'}`;
                            break;
                    }
                }

                // Call Gemini API with image
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-goog-api-key': GEMINI_API_KEY,
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: prompt
                                },
                                {
                                    inline_data: {
                                        mime_type: imageFile.type,
                                        data: base64Image.split(',')[1] // Remove data:image/... prefix
                                    }
                                }
                            ]
                        }],
                        generationConfig: {
                            temperature: 0.4,
                            topK: 32,
                            topP: 1,
                            maxOutputTokens: 2048,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(`API error: ${data.error.message}`);
                }

                const aiResponse = data.candidates[0].content.parts[0].text.trim();

                // Parse results based on analysis type
                let description = aiResponse;
                let extractedText = '';

                if (analysisType === 'ocr' || analysisType === 'comprehensive') {
                    // Try to extract text from the response
                    const textMatch = aiResponse.match(/(?:text|Text|TEXT).*?[:\-]\s*(.+?)(?:\n\n|\n|$)/s);
                    if (textMatch) {
                        extractedText = textMatch[1].trim();
                    } else if (analysisType === 'ocr') {
                        extractedText = aiResponse;
                    }
                }

                return {
                    description: description,
                    ocr: extractedText
                };

            } catch (error) {
                console.error('Gemini API Error:', error);

                if (error.message?.includes('API_KEY') || error.message?.includes('quota') || error.message?.includes('billing') ||
                    error.message?.includes('403') || error.message?.includes('429')) {
                    throw new Error('AI service temporarily unavailable. Please check API configuration or try again later.');
                }

                throw error;
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function displayResults(results) {
            analysisResults = results;

            descriptionContent.textContent = results.description;

            if (results.ocr && results.ocr.trim()) {
                ocrContent.textContent = results.ocr.trim();
            } else {
                ocrContent.textContent = 'No text detected in the image.';
            }

            analysisResult.style.display = 'block';
            showStatus('‚úÖ AI analysis completed successfully!', 'success');
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'description') {
                document.getElementById('descriptionTab').classList.add('active');
            } else if (tabName === 'ocr') {
                document.getElementById('ocrTab').classList.add('active');
            }
        }

        function copyResults() {
            const activeTab = document.querySelector('.tab-content.active');
            let textToCopy = '';

            if (activeTab.id === 'descriptionTab') {
                textToCopy = analysisResults.description;
            } else {
                textToCopy = analysisResults.ocr || 'No text detected in the image.';
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                showStatus('Results copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatus('Results copied to clipboard!', 'success');
            });
        }

        function downloadResults() {
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const content = `AI Image Analysis Results - ${timestamp}

DESCRIPTION:
${analysisResults.description}

EXTRACTED TEXT:
${analysisResults.ocr || 'No text detected in the image.'}

---
Generated by AI Image Analyzer Tool
`;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `image_analysis_${timestamp}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('Analysis results downloaded!', 'success');
        }

        function showStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';

            // Keep error messages visible longer
            if (type === 'error') {
                setTimeout(() => {
                    if (statusDiv.classList.contains('error')) {
                        statusDiv.style.display = 'none';
                    }
                }, 8000);
            } else {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        imageFile.addEventListener('click', function() {
            this.value = '';
        });
    </script>
</body>
</html>